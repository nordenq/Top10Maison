---
import { Image } from "@astrojs/image/components";

const { src, alt, rank, tag, loading = "lazy", width = 800, height = 800 } = Astro.props as {
  src: string;
  alt: string;
  rank?: number;
  tag?: string;
  loading?: "lazy" | "eager";
  width?: number;
  height?: number;
};

const widths = [Math.round(width / 2), width, width * 2];
---

<div class="product-image-frame">
  <div class="image-skeleton" aria-hidden="true"></div>
  <Image
    src={src}
    alt={alt}
    loading={loading}
    width={width}
    height={height}
    widths={widths}
    sizes="(max-width: 768px) 100vw, 400px"
    formats={["avif", "webp", "jpeg"]}
    onerror="this.onerror=null;this.src='/images/products/placeholder.svg';"
    onload="this.previousElementSibling && this.previousElementSibling.remove()"
  />

  {tag ? (
    <span class="absolute bottom-3 left-3 z-10 rounded-full bg-emerald-900 px-4 py-1.5 text-sm font-semibold text-white shadow-sm">
      {tag}
    </span>
  ) : null}
  {typeof rank === "number" ? (
    <span class="absolute bottom-3 right-3 z-10 flex h-10 w-10 items-center justify-center rounded-full bg-slate-900 text-base font-bold text-white shadow-sm">
      #{rank}
    </span>
  ) : null}
</div>
