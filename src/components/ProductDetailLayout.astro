---
import ProductImageStage from "./ProductImageStage.astro";
import ProductFAQ from "./ProductFAQ.astro";
import type { ProductFaqItem } from "../utils/productFaq";

export type DetailSpec = { label: string; value: string };

const {
  title,
  image,
  verdict,
  ctaUrl,
  pros,
  cons,
  bestFor,
  notFor,
  specs,
  backLink,
  faqItems = []
} = Astro.props as {
  title: string;
  image: string;
  verdict: string;
  ctaUrl: string;
  pros: string[];
  cons: string[];
  bestFor: string[];
  notFor: string[];
  specs: DetailSpec[];
  backLink: { label: string; href: string };
  faqItems?: ProductFaqItem[];
};

const verdictText = verdict.trim();
const verdictSentences = verdictText.split(/(?<=\.)\s+/);
const heroVerdict = verdictSentences[0] ?? verdictText;
const verdictRemainder = verdictSentences.slice(1).join(" ").trim();
const detailItems = specs.filter((item) => item.label && item.value);
---

<article class="page-container" data-drawer-fragment>
  <div class="mx-auto w-full max-w-5xl space-y-6">
    <section class="card p-5 md:p-7">
      <div class="grid gap-6 md:grid-cols-[minmax(220px,_280px)_1fr] md:items-stretch">
        <ProductImageStage src={image} alt={title} loading="eager" fetchpriority="high" />
        <div class="flex flex-col gap-4">
          <h1 class="text-3xl font-semibold text-ink" data-drawer-title>{title}</h1>
          <p class="text-base font-medium leading-relaxed text-ink/80 sm:text-lg" data-drawer-verdict>
            {heroVerdict}
          </p>
          {verdictRemainder ? (
            <p class="text-sm leading-relaxed text-ink/70">{verdictRemainder}</p>
          ) : null}
          <div class="pt-1">
            <a
              class="btn w-full text-sm md:w-auto"
              href={ctaUrl}
              rel="nofollow sponsored"
              target="_blank"
              data-affiliate="amazon"
            >
              View on Amazon
            </a>
          </div>
        </div>
      </div>
    </section>

    <section class="grid gap-4 md:grid-cols-2">
      <div class="card p-5">
        <h2 class="text-base font-semibold text-ink">Pros</h2>
        <ul class="mt-3 list-clean space-y-2 text-sm text-ink/70">
          {pros.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </div>
      <div class="card p-5">
        <h2 class="text-base font-semibold text-ink">Cons</h2>
        <ul class="mt-3 list-clean space-y-2 text-sm text-ink/70">
          {cons.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </div>
      <div class="card p-5">
        <h2 class="text-base font-semibold text-ink">Best for</h2>
        <ul class="mt-3 list-clean space-y-2 text-sm text-ink/70">
          {bestFor.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </div>
      <div class="card p-5">
        <h2 class="text-base font-semibold text-ink">Not ideal for</h2>
        <ul class="mt-3 list-clean space-y-2 text-sm text-ink/70">
          {notFor.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      </div>
    </section>

    <section class="card p-5">
      <h2 class="text-base font-semibold text-ink">Key details</h2>
      <dl class="mt-3 grid gap-2 text-sm text-ink/70">
        {detailItems.map((item) => (
          <div class="flex items-start justify-between gap-4">
            <dt class="text-ink/60">{item.label}</dt>
            <dd class="text-right font-medium text-ink">{item.value}</dd>
          </div>
        ))}
      </dl>
    </section>

    <ProductFAQ items={faqItems} />

    <section class="border-t border-border/60 pt-4">
      <p class="text-sm font-semibold text-ink">See the full list</p>
      <a class="mt-2 inline-flex text-sm font-semibold text-accent" href={backLink.href}>
        {backLink.label} â†’
      </a>
    </section>
  </div>
</article>
