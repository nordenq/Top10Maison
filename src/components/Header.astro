---
import { buildDataIndex } from "../utils/data";
import { categoryUrl, homeUrl } from "../utils/routes";

const { categories } = buildDataIndex();
---

<header
  id="site-header"
  class="sticky top-0 z-20 border-b border-border bg-white/90 backdrop-blur"
>
  <div class="mx-auto flex w-full max-w-6xl items-center justify-between px-6 py-4">
    <a class="text-lg font-semibold tracking-tight" href={homeUrl()}>Top10Maison</a>
    <nav class="hidden items-center gap-6 text-sm font-medium md:flex">
      <a href={homeUrl()}>Home</a>
      <a href="/#top-categories">Categories</a>
      <a href="/about/">About</a>
      <a href="/contact/">Contact</a>
    </nav>
    <button
      id="mobile-menu-button"
      class="md:hidden rounded-xl border border-border px-3 py-2 text-sm font-medium"
      type="button"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      Menu
    </button>
  </div>
  <div id="mobile-menu" class="hidden border-t border-border bg-white md:hidden">
    <div class="space-y-4 px-6 py-4 text-sm">
      <a class="block font-medium" href={homeUrl()}>Home</a>
      <a class="block font-medium" href="/about/">About</a>
      <a class="block font-medium" href="/contact/">Contact</a>
      <details class="rounded-xl border border-border p-3">
        <summary class="cursor-pointer font-semibold">Categories</summary>
        <div class="mt-3 grid gap-2">
          {categories.map((category) => (
            <a class="rounded-lg bg-background px-3 py-2" href={categoryUrl(category.slug)}>
              {category.name}
            </a>
          ))}
        </div>
      </details>
    </div>
  </div>
</header>

<script>
  const header = document.getElementById('site-header');
  const menuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');

  function updateScrollState() {
    if (!header) {
      return;
    }
    header.dataset.scrolled = window.scrollY > 12 ? 'true' : 'false';
  }

  window.addEventListener('scroll', updateScrollState);
  updateScrollState();

  menuButton?.addEventListener('click', function () {
    if (!mobileMenu || !menuButton) {
      return;
    }
    const isOpen = !mobileMenu.classList.contains('hidden');
    mobileMenu.classList.toggle('hidden');
    menuButton.setAttribute('aria-expanded', (!isOpen).toString());
  });
</script>
