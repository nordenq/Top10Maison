---
import type { Product } from "../utils/data";
import TopPickRow from "./TopPickRow.astro";

const {
  title,
  intro,
  products,
  schema = false,
  startRank = 1,
  id,
  eagerCount = 1,
  class: className = "",
  embedded = false
} = Astro.props as {
  title: string;
  intro?: string;
  products: Product[];
  schema?: boolean;
  startRank?: number;
  id?: string;
  eagerCount?: number;
  class?: string;
  embedded?: boolean;
};
---

{embedded ? (
  <section id={id}>
    <h2 class="text-2xl font-semibold">{title}</h2>
    {intro ? <p class="mt-3 text-sm text-ink/70">{intro}</p> : null}
    <div class="mt-6 grid gap-6">
      {products.map((product, index) => (
        <TopPickRow
          image={product.image}
          title={product.name}
          brand={product.brand}
          rating={product.rating}
          priceTag={product.price}
          badge={product.badge}
          summary={product.reviewSnippet ?? product.description}
          pros={product.pros}
          cons={product.cons}
          ctaUrl={product.affiliateUrl}
          reviewUrl={product.slug ? `/product/${product.slug}/` : undefined}
          rank={startRank + index}
          schema={schema}
          loading={index < eagerCount ? "eager" : "lazy"}
          fetchpriority={index === 0 && eagerCount > 0 ? "high" : undefined}
        />
      ))}
    </div>
  </section>
) : (
  <section class={`section${className ? ` ${className}` : ""}`} id={id}>
    <div class="page-container">
      <h2 class="text-2xl font-semibold">{title}</h2>
      {intro ? <p class="mt-3 text-sm text-ink/70">{intro}</p> : null}
      <div class="mt-6 grid gap-6">
        {products.map((product, index) => (
        <TopPickRow
          image={product.image}
          title={product.name}
          brand={product.brand}
          rating={product.rating}
          priceTag={product.price}
          badge={product.badge}
          summary={product.reviewSnippet ?? product.description}
          pros={product.pros}
          cons={product.cons}
          ctaUrl={product.affiliateUrl}
          reviewUrl={product.slug ? `/product/${product.slug}/` : undefined}
          rank={startRank + index}
          schema={schema}
          loading={index < eagerCount ? "eager" : "lazy"}
          fetchpriority={index === 0 && eagerCount > 0 ? "high" : undefined}
        />
        ))}
      </div>
    </div>
  </section>
)}
