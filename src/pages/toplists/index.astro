---
import Layout from "../../layouts/BaseLayout.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import { getDataIndex } from "../../utils/dataIndex";
import { buildCanonical, requireSite } from "../../utils/seo";
import { buildBreadcrumbSchema } from "../../utils/schema";
import { childSubcategoryUrl } from "../../utils/routes";
import { getToplistDisplay } from "../../utils/toplistDisplay";
import TopListRow from "../../components/TopListRow.astro";

const dataIndex = getDataIndex();
const { categories, toplists, categoryMap, subcategoryMap } = dataIndex;

const site = requireSite(Astro.site);
const title = "Top Lists - Home Appliances & Gadgets Rankings 2026 | Top10Maison";
const description =
  "Explore curated 2026 rankings for kitchen gear, cleaning gadgets, climate control, and smart home essentials. Compare top products side by side to find the right fit.";
const canonical = buildCanonical(site, "/toplists/");
const ogImage = "/images/toplists/hero.webp";
const ogType = "website";
const breadcrumbItems = [
  { name: "Home", path: "/" },
  { name: "Top Lists", path: "/toplists/" }
];
const schema = [buildBreadcrumbSchema(site, breadcrumbItems)];
const breadcrumbLinks = breadcrumbItems.map((item) => ({ name: item.name, href: item.path }));

const sortedToplists = [...toplists].sort((a, b) => {
  const aCategory = categoryMap.get(a.category)?.name ?? a.category;
  const bCategory = categoryMap.get(b.category)?.name ?? b.category;
  if (aCategory !== bCategory) return aCategory.localeCompare(bCategory);
  const aSub = subcategoryMap.get(`${a.category}:${a.subcategory}`)?.name ?? a.subcategory;
  const bSub = subcategoryMap.get(`${b.category}:${b.subcategory}`)?.name ?? b.subcategory;
  if (aSub !== bSub) return aSub.localeCompare(bSub);
  return (a.title ?? "").localeCompare(b.title ?? "");
});

const buildToplistSnippet = (count: number, productName: string, useCase: string) =>
  `Top ${count} ${productName.toLowerCase()} ranked for ${useCase.toLowerCase()}.`;
---

<Layout
  title={title}
  description={description}
  canonical={canonical}
  schema={schema}
  ogImage={ogImage}
  ogType={ogType}
>
  <section class="section section--soft">
    <div class="page-container">
      <Breadcrumbs items={breadcrumbLinks} />
      <h1 class="mt-4 text-3xl font-semibold">Top lists</h1>
      <p class="mt-3 text-lg text-ink/70">
        A directory of rankings across categories. Use the category path to find the right list quickly.
      </p>
    </div>
  </section>

  <section class="section">
    <div class="page-container">
      <h2 class="text-2xl font-semibold">All rankings</h2>
      <ul class="mt-4">
        {sortedToplists.map((list) => {
          const category = categoryMap.get(list.category);
          const subcategory = subcategoryMap.get(`${list.category}:${list.subcategory}`);
          const display = getToplistDisplay(list, dataIndex);
          const label = `${category?.name ?? "Category"} \u2192 ${subcategory?.name ?? "Subcategory"}`;
          return (
            <TopListRow
              title={display.schemaHeadline}
              href={childSubcategoryUrl(list.category, list.subcategory, list.childsubcategory)}
              categoryLabel={label}
              description={buildToplistSnippet(list.count, display.productName, display.useCase)}
              year={display.year}
            />
          );
        })}
      </ul>
    </div>
  </section>
</Layout>
