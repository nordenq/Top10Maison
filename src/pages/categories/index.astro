---
import Layout from "../../layouts/BaseLayout.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import CategoryCard from "../../components/CategoryCard.astro";
import { getDataIndex } from "../../utils/dataIndex";
import { categoryUrl } from "../../utils/routes";
import { buildCanonical, requireSite } from "../../utils/seo";
import { buildBreadcrumbSchema, buildItemListSchema } from "../../utils/schema";

const { categories } = getDataIndex();

const site = requireSite(Astro.site);
const title = "All Categories";
const description = "Browse every Top10Maison category and drill down into subcategories to find the right top list.";
const canonical = buildCanonical(site, "/categories/");
const breadcrumbItems = [
  { name: "Home", path: "/" },
  { name: "Categories", path: "/categories/" }
];
const schema = [
  buildBreadcrumbSchema(site, breadcrumbItems),
  buildItemListSchema(
    categories.map((category) => ({
      name: category.name,
      url: new URL(categoryUrl(category.slug), site).toString()
    }))
  ),
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    name: title,
    description,
    url: canonical
  }
];
const breadcrumbLinks = breadcrumbItems.map((item) => ({ name: item.name, href: item.path }));
const ogImage = categories[0]?.image ?? "/logo.svg";
---

<Layout title={title} description={description} canonical={canonical} schema={schema} ogImage={ogImage}>
  <section class="section">
    <div class="page-container">
      <Breadcrumbs items={breadcrumbLinks} />
      <h1 class="mt-4 text-3xl font-semibold">All categories</h1>
      <p class="mt-3 text-lg text-ink/70">
        Pick a category, then drill down into subcategories to find the right top list.
      </p>
    </div>
  </section>

  <section class="section bg-soft">
    <div class="page-container">
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {categories.map((category, index) => (
          <CategoryCard
            category={category}
            loading={index < 3 ? "eager" : "lazy"}
            fetchpriority={index === 0 ? "high" : undefined}
          />
        ))}
      </div>
    </div>
  </section>
</Layout>
