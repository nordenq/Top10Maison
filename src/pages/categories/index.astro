---
import Layout from "../../layouts/BaseLayout.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import CategoryCard from "../../components/CategoryCard.astro";
import { getDataIndex } from "../../utils/dataIndex";
import { categoryUrl, subcategoryUrl } from "../../utils/routes";
import { buildCanonical, requireSite } from "../../utils/seo";
import { buildBreadcrumbSchema, buildItemListSchema } from "../../utils/schema";

const { categories } = getDataIndex();

const site = requireSite(Astro.site);
const title = "All Categories";
const description = "Browse every Top10Maison category and jump into subcategories to find the best curated top lists.";
const canonical = buildCanonical(site, "/categories/");
const breadcrumbItems = [
  { name: "Home", path: "/" },
  { name: "Categories", path: "/categories/" }
];
const schema = [
  buildBreadcrumbSchema(site, breadcrumbItems),
  buildItemListSchema(
    categories.map((category) => ({
      name: category.name,
      url: new URL(categoryUrl(category.slug), site).toString()
    }))
  ),
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    name: title,
    description,
    url: canonical
  }
];
const breadcrumbLinks = breadcrumbItems.map((item) => ({ name: item.name, href: item.path }));
const ogImage = categories[0]?.image ?? "/logo.svg";
---

<Layout title={title} description={description} canonical={canonical} schema={schema} ogImage={ogImage}>
  <section class="section">
    <div class="page-container">
      <Breadcrumbs items={breadcrumbLinks} />
      <h1 class="mt-4 text-3xl font-semibold">All categories</h1>
      <p class="mt-3 text-lg text-ink/70">
        Pick a category, then drill down into subcategories to find the right top list.
      </p>
    </div>
  </section>

  <section class="section bg-surface">
    <div class="page-container">
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {categories.map((category, index) => (
          <CategoryCard
            category={category}
            loading={index < 3 ? "eager" : "lazy"}
            fetchpriority={index === 0 ? "high" : undefined}
          />
        ))}
      </div>
    </div>
  </section>

  <section class="section">
    <div class="page-container space-y-10">
      {categories.map((category) => (
        <div class="card p-6">
          <div class="flex flex-wrap items-baseline justify-between gap-3">
            <h2 class="text-2xl font-semibold">
              <a class="hover:text-accent" href={categoryUrl(category.slug)}>{category.name}</a>
            </h2>
            <a class="text-sm font-semibold text-accent" href={categoryUrl(category.slug)}>View category â†’</a>
          </div>
          <p class="mt-3 text-sm text-ink/70">{category.description}</p>
          <div class="mt-6 grid gap-3 md:grid-cols-2 lg:grid-cols-3">
            {category.subcategories.map((subcategory) => (
              <a
                class="rounded-xl border border-border bg-background px-4 py-3 text-sm font-medium text-ink/80 transition-colors hover:border-accent hover:text-accent"
                href={subcategoryUrl(category.slug, subcategory.slug)}
              >
                {subcategory.name}
              </a>
            ))}
          </div>
        </div>
      ))}
    </div>
  </section>
</Layout>

