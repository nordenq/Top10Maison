---
import Layout from "../../../../../layouts/BaseLayout.astro";
import { getDataIndex } from "../../../../../utils/dataIndex";
import { buildCanonical, requireSite } from "../../../../../utils/seo";

export function getStaticPaths() {
  const { toplists } = getDataIndex();
  return toplists.map((list) => ({
    params: {
      category: list.category,
      subcategory: list.subcategory,
      childsubcategory: list.childsubcategory,
      n: String(list.count),
      keyword: list.keywordSlug
    }
  }));
}

const { category, subcategory, childsubcategory, n, keyword } = Astro.params;
const site = requireSite(Astro.site);
const { toplists } = getDataIndex();
const match = toplists.find(
  (list) =>
    list.category === category &&
    list.subcategory === subcategory &&
    list.childsubcategory === childsubcategory &&
    String(list.count) === String(n) &&
    list.keywordSlug === keyword
);

const redirectPath = match ? `/toplists/${match.slug}/` : "/toplists/";
const redirectUrl = buildCanonical(site, redirectPath);
const description = `This top list now lives at ${redirectUrl}. You are being redirected.`;
---

<Layout
  title="Top list moved | Top10Maison"
  description={description}
  canonical={redirectUrl}
  robots="noindex,follow"
>
  <Fragment slot="head">
    <meta http-equiv="refresh" content={`0;url=${redirectUrl}`} />
  </Fragment>
  <section class="section">
    <div class="mx-auto w-full max-w-3xl text-center">
      <h1 class="text-2xl font-semibold">This top list has moved</h1>
      <p class="mt-3 text-sm text-ink/70">
        We updated our URL structure. You will be redirected automatically.
      </p>
      <a class="btn mt-6" href={redirectUrl}>Continue to the top list</a>
      <p class="mt-3 text-xs text-ink/60">
        Old path: /category/{category}/{subcategory}/{childsubcategory}/top-{n}-{keyword}
      </p>
    </div>
  </section>
</Layout>
