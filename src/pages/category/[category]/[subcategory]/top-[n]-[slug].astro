---
import Layout from "../../../../layouts/BaseLayout.astro";
import { getTopListData } from "../../../../utils/data";
import { getDataIndex } from "../../../../utils/dataIndex";
import { buildCanonical, requireSite } from "../../../../utils/seo";
import { childSubcategoryUrl } from "../../../../utils/routes";

export function getStaticPaths() {
  const { toplists } = getDataIndex();
  return toplists.map((list) => ({
    params: {
      category: list.category,
      subcategory: list.subcategory,
      n: String(list.count),
      slug: list.keywordSlug
    }
  }));
}

const { category, subcategory, n, slug } = Astro.params;
const toplist = getTopListData(category, subcategory, n, slug);

const site = requireSite(Astro.site);
const redirectPath = childSubcategoryUrl(
  toplist.category.slug,
  toplist.subcategory.slug,
  toplist.childsubcategory.slug
);
const redirectUrl = buildCanonical(site, redirectPath);
const description = `This top list has moved to ${redirectUrl}. You are being redirected.`;
---

<Layout
  title="Top list moved | Top10Maison"
  description={description}
  canonical={redirectUrl}
  robots="noindex,follow"
  metaRefresh={`0; url=${redirectUrl}`}
>
  <section class="section">
    <div class="mx-auto w-full max-w-3xl text-center">
      <h1 class="text-2xl font-semibold">This top list has moved</h1>
      <p class="mt-3 text-sm text-ink/70">
        We now use category pages for browsing. Youâ€™ll be redirected automatically.
      </p>
      <a class="btn mt-6" href={redirectUrl}>Continue</a>
      <p class="mt-3 text-xs text-ink/60">
        Old path: /category/{category}/{subcategory}/top-{n}-{slug}
      </p>
    </div>
  </section>
</Layout>
