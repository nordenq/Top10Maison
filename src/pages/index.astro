---
import BaseLayout from "../layouts/BaseLayout.astro";
import CategoryNav from "../components/CategoryNav.astro";
import { buildDataIndex } from "../utils/data";
import { subcategoryToplistUrl, categoryUrl } from "../utils/routes";
import { buildCanonical, requireSite } from "../utils/seo";
import { buildBreadcrumbSchema } from "../utils/schema";

const { categories, toplists } = buildDataIndex();
const latestToplists = [...toplists].sort((a, b) => b.performanceScore - a.performanceScore).slice(0, 4);
const categoryMap = new Map(categories.map((category) => [category.slug, category]));

const site = requireSite(Astro.site);
const title = "Top10Maison | Data-Driven Product Rankings";
const description = "Unbiased product rankings and comparisons to help you choose the best for your home.";
const canonical = buildCanonical(site, "/");
const schema = [buildBreadcrumbSchema(site, [{ name: "Home", path: "/" }])];
---

<BaseLayout
  title={title}
  description={description}
  canonical={canonical}
  schema={schema}
  ogImage="/og-image.jpg"
>
  <section class="section bg-white">
    <div class="page-container grid items-center gap-10 md:grid-cols-2">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-ink/70">Top10Maison</p>
        <h1 class="mt-3 text-4xl font-semibold md:text-5xl">Clear rankings for smarter home buys.</h1>
        <p class="mt-4 text-lg text-ink/70">
          We publish data-driven, UX-friendly guides so you can compare the best products in minutes.
        </p>
        <div class="mt-6 flex flex-wrap gap-3">
          <a class="btn" href="#top-categories">Browse categories</a>
          <a class="btn-ghost" href="#latest-toplists">Latest top lists</a>
        </div>
      </div>
      <div class="card p-6">
        <h2 class="text-xl font-semibold">Why readers trust us</h2>
        <ul class="mt-4 space-y-3 text-sm text-ink/70">
          <li>Consistent ranking criteria across every guide.</li>
          <li>Focused shortlists that make decisions faster.</li>
          <li>Transparent affiliate disclosure with every recommendation.</li>
        </ul>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="page-container">
      <CategoryNav categories={categories} className="pb-2" />
    </div>
  </section>

  <section id="top-categories" class="section bg-white">
    <div class="page-container">
      <div class="flex flex-wrap items-end justify-between gap-4">
        <div>
          <h2 class="text-2xl font-semibold">Top categories</h2>
          <p class="mt-2 text-sm text-ink/70">Start with a room, then drill down to the best lists.</p>
        </div>
        <a class="text-sm font-semibold text-accent" href="/#top-categories">View all</a>
      </div>
      <div class="mt-6 grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {categories.map((category) => (
          <a class="card flex items-start gap-4 p-5" href={categoryUrl(category.slug)}>
            <span class="grid h-12 w-12 place-items-center rounded-xl bg-background text-lg font-semibold text-ink">
              {category.name.slice(0, 1).toUpperCase()}
            </span>
            <div>
              <h3 class="text-lg font-semibold">{category.name}</h3>
              <p class="mt-2 text-sm text-ink/70">{category.description}</p>
            </div>
          </a>
        ))}
      </div>
    </div>
  </section>

  <section id="latest-toplists" class="section">
    <div class="page-container">
      <div class="flex flex-wrap items-end justify-between gap-4">
        <div>
          <h2 class="text-2xl font-semibold">Latest top lists</h2>
          <p class="mt-2 text-sm text-ink/70">Freshly updated guides with ranked picks and quick advice.</p>
        </div>
      </div>
      <div class="mt-6 grid gap-6 md:grid-cols-2">
        {latestToplists.map((list) => {
          const category = categoryMap.get(list.category);
          const image = category?.image ?? "/logo.svg";
          return (
            <a
              class="card grid gap-4 overflow-hidden md:grid-cols-[200px_1fr]"
              href={subcategoryToplistUrl(list.category, list.subcategory, list.count, list.keywordSlug)}
            >
              <img
                class="h-full w-full object-cover"
                src={image}
                alt={list.title}
                loading="lazy"
                width="400"
                height="300"
              />
              <div class="p-5">
                <p class="text-xs font-semibold uppercase tracking-[0.25em] text-ink/70">Top list</p>
                <h3 class="mt-2 text-lg font-semibold">{list.title}</h3>
                <p class="mt-2 text-sm text-ink/70">{list.metaDescription}</p>
              </div>
            </a>
          );
        })}
      </div>
    </div>
  </section>

  <section class="section bg-white">
    <div class="page-container">
      <h2 class="text-2xl font-semibold">What is Top10Maison?</h2>
      <p class="mt-3 text-sm text-ink/70">
        Top10Maison is a home-focused review site that ranks products using consistent criteria, transparent
        scoring, and real-world use cases. Our goal is to help you choose faster with shortlists that reflect
        everyday needs, not marketing hype.
      </p>
    </div>
  </section>
</BaseLayout>
