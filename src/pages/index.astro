---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getDataIndex } from "../utils/dataIndex";
import { buildCanonical, requireSite } from "../utils/seo";
import { buildBreadcrumbSchema } from "../utils/schema";
import CategoryCard from "../components/CategoryCard.astro";
import { childSubcategoryUrl } from "../utils/routes";
import { getToplistDisplay } from "../utils/toplistDisplay";

const dataIndex = getDataIndex();
const { categories, toplists, categoryMap, subcategoryMap, childSubcategoryMap } = dataIndex;
const ogImage = categories[0]?.image ?? "/logo.svg";
const latestToplists = [...toplists]
  .sort((a, b) => {
    const aTime = a.schemaDatePublished ? Date.parse(a.schemaDatePublished) : 0;
    const bTime = b.schemaDatePublished ? Date.parse(b.schemaDatePublished) : 0;
    return (Number.isFinite(bTime) ? bTime : 0) - (Number.isFinite(aTime) ? aTime : 0);
  })
  .slice(0, 6);

const site = requireSite(Astro.site);
const title = "Top10Maison â€” Clear, data-based product rankings";
const description =
  "Top10Maison publishes clear, data-based product rankings built from publicly available information and reviewed for clarity and fairness.";
const canonical = buildCanonical(site, "/");
const schema = [buildBreadcrumbSchema(site, [{ name: "Home", path: "/" }])];
---

<BaseLayout
  title={title}
  description={description}
  canonical={canonical}
  schema={schema}
  ogImage={ogImage}
>
  <section class="section section--soft">
    <div class="page-container">
      <p class="text-xs font-semibold uppercase tracking-[0.3em] text-ink/70">For your home</p>
      <h1 class="mt-3 text-4xl font-semibold md:text-5xl">
        Clear, data-powered rankings for your home.
      </h1>
      <p class="mt-4 text-lg text-ink/70">
        Top10Maison uses data-based review technology to analyze public product information and publish clear,
        practical rankings you can trust.
      </p>
      <div class="mt-6 flex flex-wrap gap-3">
        <a class="btn" href="/categories/">Browse home categories</a>
        <a class="btn-ghost" href="/toplists/">Explore top lists</a>
      </div>
    </div>
  </section>

  <section id="latest-top-lists" class="section">
    <div class="page-container">
      <div class="flex flex-wrap items-end justify-between gap-4">
        <div>
          <h2 class="text-2xl font-semibold">Latest top lists</h2>
          <p class="mt-2 text-sm text-ink/70">Recently updated rankings</p>
        </div>
      </div>
      <div class="mt-6 grid gap-6 md:grid-cols-2">
        {latestToplists.map((list, index) => {
          const childKey = `${list.category}:${list.subcategory}:${list.childsubcategory}`;
          const child = childSubcategoryMap.get(childKey);
          const category = categoryMap.get(list.category);
          const subcategory = subcategoryMap.get(`${list.category}:${list.subcategory}`);
          const display = getToplistDisplay(list, dataIndex);
          const image =
            list.image ??
            child?.image ??
            subcategory?.image ??
            category?.image ??
            "/logo.svg";
          const imageSrcset =
            list.imageSrcset ??
            child?.imageSrcset ??
            subcategory?.imageSrcset ??
            category?.imageSrcset;
          const isLcp = index === 0;
          return (
            <a
              class="toplist-card card card-hover grid gap-4 overflow-hidden md:grid-cols-[200px_1fr]"
              href={childSubcategoryUrl(list.category, list.subcategory, list.childsubcategory)}
            >
              <div class="toplist-card__image">
                <img
                  class="h-full w-full object-cover"
                  src={image}
                  alt={display.schemaHeadline}
                  loading={isLcp ? "eager" : "lazy"}
                  fetchpriority={isLcp ? "high" : undefined}
                  decoding="async"
                  srcset={imageSrcset}
                  sizes="(max-width: 768px) 100vw, 200px"
                  width="400"
                  height="300"
                />
              </div>
              <div class="p-5">
                <p class="text-xs font-semibold uppercase tracking-[0.25em] text-ink/70">
                  {child?.name ?? subcategory?.name ?? category?.name ?? "Top list"}
                </p>
                <h3 class="mt-2 text-lg font-semibold">{display.schemaHeadline}</h3>
                <p class="mt-2 text-sm text-ink/70">{list.metaDescription}</p>
              </div>
            </a>
          );
        })}
      </div>
    </div>
  </section>

  <section id="top-categories" class="section section--soft">
    <div class="page-container">
      <div class="flex flex-wrap items-end justify-between gap-4">
        <div>
          <h2 class="text-2xl font-semibold">Top categories</h2>
          <p class="mt-2 text-sm text-ink/70">Browse by room</p>
        </div>
        <a class="text-sm font-semibold text-ink/70 transition-colors hover:text-accent" href="/categories/">View all</a>
      </div>
      <div class="mt-6 grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {categories.map((category, index) => (
          <CategoryCard
            category={category}
            loading={index < 3 ? "eager" : "lazy"}
            fetchpriority={index === 0 ? "high" : undefined}
          />
        ))}
      </div>
    </div>
  </section>

  <section class="section">
    <div class="page-container">
      <h2 class="text-2xl font-semibold">Why Top10Maison works</h2>
      <div class="mt-6 grid gap-6 md:grid-cols-3">
        <div class="card card-hover p-5">
          <div class="flex items-center gap-3">
            <span class="brand-icon">
              <svg viewBox="0 0 24 24" class="h-5 w-5" aria-hidden="true">
                <path
                  d="M4 7.5C4 5.6 5.6 4 7.5 4h9C18.4 4 20 5.6 20 7.5v9c0 1.9-1.6 3.5-3.5 3.5h-9C5.6 20 4 18.4 4 16.5v-9z"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M8 9.5h8M8 12.5h5M8 15.5h6"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <circle class="accent-dot" cx="18.2" cy="6" r="1.3" fill="#2BBBAD" />
              </svg>
            </span>
            <h3 class="text-lg font-semibold">Consistent comparison criteria</h3>
          </div>
          <p class="mt-3 text-sm text-ink/70">
            Same framework across lists so rankings stay clear.
          </p>
        </div>
        <div class="card card-hover p-5">
          <div class="flex items-center gap-3">
            <span class="brand-icon">
              <svg viewBox="0 0 24 24" class="h-5 w-5" aria-hidden="true">
                <path
                  d="M6 7.5h12M6 12h7M6 16.5h10"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <circle
                  class="accent-dot"
                  cx="18"
                  cy="12"
                  r="3"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <circle class="accent-dot" cx="19.5" cy="8.2" r="1.2" fill="#2BBBAD" />
              </svg>
            </span>
            <h3 class="text-lg font-semibold">Shortlists, not catalogs</h3>
          </div>
          <p class="mt-3 text-sm text-ink/70">
            Only the picks that earn their spot.
          </p>
        </div>
        <div class="card card-hover p-5">
          <div class="flex items-center gap-3">
            <span class="brand-icon">
              <svg viewBox="0 0 24 24" class="h-5 w-5" aria-hidden="true">
                <path
                  d="M7.5 4.5h6.5L18 8v11c0 .9-.7 1.5-1.5 1.5h-9C6.7 20.5 6 19.9 6 19V6c0-.8.7-1.5 1.5-1.5z"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <path
                  d="M9 12l2 2 4-4"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <circle class="accent-dot" cx="16.8" cy="6.3" r="1.2" fill="#2BBBAD" />
              </svg>
            </span>
            <h3 class="text-lg font-semibold">Editorial review for clarity</h3>
          </div>
          <p class="mt-3 text-sm text-ink/70">
            Each ranking is reviewed for clarity and fairness.
          </p>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
